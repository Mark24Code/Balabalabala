# 执行环境和作用域

----

## 1.作用域链

执行环境(execution context) 是JS中最重要的一个概念。执行环境定义了变量或者函数有权访问的其他数据。决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象（variable object）,环境中定义的所有变量和函数都保存在这个对象中，虽然我们编写的代码无法访问这个对象，但是解释器，在处理数据的时候，会在后台使用它。

ES控制机制:
每个函数都有自己的执行环境，当执行流进入一个函数时，函数的环境，就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回之前的执行环境。

当代码在一个环境中执行时，会创建变量对象的一个作用域链。作用域链的用途，是保证对执行环境有权访问的所有变量和函数的有序访问，作用域链的前端，始终都是当前执行代码所在的环境变量。


【作用图链的嵌套图 红书3 P73 图4-3】

内部可以通过作用域链访问所有外部坏境，但是外部不能访问内部环境中任何变量和函数。这些环境之间的联系是线性的、有次序的。每个环节都可以向上搜索作用域链，以查询变量和函数名。


### 1.1 延长作用域链

执行环境的类型总共有两种——全局和局部(函数)。

with，catch

但是存在IE8实现不一致

我忽略这边。

### 1.2 没有块级作用域

其他类C的语言中，由花括号封闭的代码块都有自己的作用域。ES的话讲，就是自己的执行环境。

```JavaScript
if(true){
    var color = "blue";
}
alert(color);//"blue"
```
这里在一个if语句中定义了变量color。如果是C/C++或者Java中，color会在if语句执行完毕后被销毁，但是在JS中，if语句的变量声明会将变量添加到当前的执行环境（全局环境中）。
```JavaScript
for (var i=0; i < 10; i++){
        doSomething(i);
}
alert(i);      //10
```

####  Tips：
Python和JS一样，对于 if 和 for也不创建块级作用域。


对于有块级作用域的函数来说，变量只存在于循环的环境之中。对于JS来说，循环结束，变量依然在。



## 2.不加var声明的是全局变量